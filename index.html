<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Equipment Check</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .warning {
            background-color: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
            display: none;
        }
        form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }
        input[type="text"], input[type="date"], select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .checklist {
            margin-top: 20px;
            display: none;
        }
        .checklist.active {
            display: block;
        }
        .item {
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 5px solid #bdc3c7;
        }
        .item.fail {
            border-left-color: #e74c3c;
            background-color: #fdf2f2;
        }
        .item-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 8px;
        }
        .item-header label {
            margin: 0;
            font-weight: normal;
        }
        textarea {
            width: 100%;
            height: 60px;
            padding: 8px;
            margin-top: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            margin-top: 30px;
            padding: 12px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #2980b9;
        }
        #summary {
            margin-top: 40px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 10px;
            display: none;
        }
        @media print {
            body { margin: 0; }
            button, select { display: none; }
            #summary { display: block !important; }
            .warning { display: block !important; }
        }
    </style>
</head>
<body>
    <h1>Daily Equipment Check</h1>

    <div id="warning" class="warning">
        Equipment not safe – report defects immediately!
    </div>

    <form id="checkForm">
        <label for="equipment">Equipment Type</label>
        <select id="equipment" required>
            <option value="">-- Select Equipment --</option>
            <option value="forklift">Forklift</option>
            <option value="loader">Front-End Loader</option>
        </select>

        <label for="date">Date</label>
        <input type="date" id="date" required>

        <label for="operator">Operator Name</label>
        <input type="text" id="operator" required>

        <label for="equipmentId">Equipment ID / Number</label>
        <input type="text" id="equipmentId" required>

        <!-- Forklift Checklist -->
        <div id="forklift-checklist" class="checklist">
            <h2>Forklift Checklist</h2>
            <div class="item" data-id="1">
                <div class="item-header">
                    <strong>1. Tires: condition and pressure</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="2">
                <div class="item-header">
                    <strong>2. Forks: condition and pins</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="3">
                <div class="item-header">
                    <strong>3. Hydraulic system: leaks</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="4">
                <div class="item-header">
                    <strong>4. Mast and carriage: damage or wear</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="5">
                <div class="item-header">
                    <strong>5. Brakes: operation and parking brake</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="6">
                <div class="item-header">
                    <strong>6. Steering: smooth operation</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="7">
                <div class="item-header">
                    <strong>7. Lights, horn, and backup alarm</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="8">
                <div class="item-header">
                    <strong>8. Battery / Fuel level and condition</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="9">
                <div class="item-header">
                    <strong>9. Seat belt and operator compartment</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
        </div>

        <!-- Front-End Loader Checklist -->
        <div id="loader-checklist" class="checklist">
            <h2>Front-End Loader Checklist</h2>
            <div class="item" data-id="1">
                <div class="item-header">
                    <strong>1. Tires / Tracks: condition and pressure/tension</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="2">
                <div class="item-header">
                    <strong>2. Bucket: teeth, cutting edge, and pins</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="3">
                <div class="item-header">
                    <strong>3. Hydraulic system: leaks and hose condition</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="4">
                <div class="item-header">
                    <strong>4. Lift arms and linkage: wear and pins</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="5">
                <div class="item-header">
                    <strong>5. Brakes: service and parking</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="6">
                <div class="item-header">
                    <strong>6. Steering and articulation joint</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="7">
                <div class="item-header">
                    <strong>7. Lights, horn, and backup alarm</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="8">
                <div class="item-header">
                    <strong>8. Engine oil, coolant, and fuel levels</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
            <div class="item" data-id="9">
                <div class="item-header">
                    <strong>9. Cab: glass, seat belt, and controls</strong>
                    <label><input type="checkbox" class="pass"> Pass</label>
                    <label><input type="checkbox" class="fail"> Fail</label>
                </div>
                <textarea placeholder="Notes (optional)"></textarea>
            </div>
        </div>

        <button type="submit">Submit Check</button>
    </form>

    <div id="summary"></div>

    <script>
        // Set today's date automatically
        document.getElementById('date').valueAsDate = new Date();

        // Show correct checklist when equipment is selected
        document.getElementById('equipment').addEventListener('change', function() {
            const value = this.value;
            document.getElementById('forklift-checklist').classList.toggle('active', value === 'forklift');
            document.getElementById('loader-checklist').classList.toggle('active', value === 'loader');
        });

        // Ensure only one checkbox (Pass or Fail) can be checked per item
        document.querySelectorAll('.item').forEach(item => {
            const pass = item.querySelector('.pass');
            const fail = item.querySelector('.fail');

            pass.addEventListener('change', () => {
                if (pass.checked) fail.checked = false;
                updateItemStyle(item);
            });
            fail.addEventListener('change', () => {
                if (fail.checked) pass.checked = false;
                updateItemStyle(item);
            });
        });

        function updateItemStyle(item) {
            if (item.querySelector('.fail').checked) {
                item.classList.add('fail');
            } else {
                item.classList.remove('fail');
            }
        }

        // Form submission
        document.getElementById('checkForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const equipmentType = document.getElementById('equipment').options[document.getElementById('equipment').selectedIndex].text;
            const date = document.getElementById('date').value;
            const operator = document.getElementById('operator').value;
            const equipmentId = document.getElementById('equipmentId').value;

            const items = document.querySelectorAll('.checklist.active .item');
            let hasFail = false;
            let results = [];

            items.forEach(item => {
                const title = item.querySelector('strong').textContent;
                const pass = item.querySelector('.pass').checked;
                const fail = item.querySelector('.fail').checked;
                const notes = item.querySelector('textarea').value.trim();

                let status = 'Not checked';
                if (pass) status = 'Pass';
                if (fail) {
                    status = 'Fail';
                    hasFail = true;
                }

                results.push({
                    title,
                    status,
                    notes: notes || 'No notes'
                });
            });

            // Show warning if any fail
            document.getElementById('warning').style.display = hasFail ? 'block' : 'none';

            // Generate summary
            let summaryHTML = `
                <h2>Daily Check Summary</h2>
                <p><strong>Equipment:</strong> ${equipmentType}</p>
                <p><strong>Date:</strong> ${date}</p>
                <p><strong>Operator:</strong> ${operator}</p>
                <p><strong>Equipment ID:</strong> ${equipmentId}</p>
                <hr>
                <h3>Checklist Results</h3>
            `;

            results.forEach(r => {
                const color = r.status === 'Pass' ? 'green' : r.status === 'Fail' ? 'red' : 'gray';
                summaryHTML += `
                    <p><strong>${r.title}</strong><br>
                    <span style="color:${color}; font-weight:bold;">${r.status}</span><br>
                    Notes: ${r.notes}</p>
                `;
            });

            if (hasFail) {
                summaryHTML += `<p style="color:red; font-weight:bold; font-size:1.2em;">Equipment not safe – report defects immediately!</p>`;
            } else {
                summaryHTML += `<p style="color:green; font-weight:bold;">All checks passed – equipment ready for use.</p>`;
            }

            summaryHTML += `<p style="margin-top:30px; font-size:0.9em; color:#666;">Print this page (Ctrl+P) to keep a record.</p>`;

            const summaryDiv = document.getElementById('summary');
            summaryDiv.innerHTML = summaryHTML;
            summaryDiv.style.display = 'block';

            // Scroll to summary
            summaryDiv.scrollIntoView({ behavior: 'smooth' });

            // Also log to console for debugging / future integration
            console.log({ equipmentType, date, operator, equipmentId, results, hasFail });
            console.log("Payload is being sent...")

            // Begin processing sending the payload
            const payload = {
              date,
              equipmentType,
              equipmentId,
              operator,
              hasFail,
              items: Array.from(items).map(item => {
                const pass = item.querySelector('.pass').checked;
                const fail = item.querySelector('.fail').checked;

                return {
                  name: item.getAttribute('data-name'),
                  status: fail ? "FAIL" : pass ? "PASS" : "NOT CHECKED",
                  notes: item.querySelector('textarea').value.trim()
                };
              })
            };

            // Send an email containing a spreadsheet with the data provided
            fetch("https://script.google.com/macros/s/AKfycbxOFZiAMYIGSsKG1qO-dDq5TlvZi1m-h_HJ2tNufFdgu1aCmApZMiv_mkEImFRAfvJv3w/exec", {
              method: "POST",
              body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then((response) => {
                // Note: GAS always returns 200 OK even on script errors, 
                // so check the 'success' property we set in the GAS script
                if(response.success){
                    console.log("Payload is sent.");
                } else {
                    console.error("Script Error:", response.error);
                }
            })
            .catch((err) => console.log(err));
        });
    </script>
</body>
</html>


