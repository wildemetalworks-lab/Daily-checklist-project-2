<script>
document.getElementById('checkForm').addEventListener('submit', function(e) {
    e.preventDefault(); // ← stops page reload

    const form = this;
    const equipment = form.equipment.value;
    const date = form.date.value;
    const operator = form.operator.value;
    const eqId = form.equipmentId.value;

    if (!equipment) {
        alert("Please select equipment type");
        return;
    }

    // Hide warning if it was shown before
    document.getElementById('warning').style.display = 'none';

    let hasFail = false;
    let summaryHTML = `
        <h2>Daily Equipment Check – ${equipment.toUpperCase()}</h2>
        <p><strong>Date:</strong> ${date || '—'}</p>
        <p><strong>Operator:</strong> ${operator || '—'}</p>
        <p><strong>Equipment ID:</strong> ${eqId || '—'}</p>
        <hr>
        <h3>Inspection Results</h3>
    `;

    // Find the active checklist
    const checklist = document.getElementById(equipment + '-checklist');
    if (!checklist) {
        alert("Checklist not found for selected equipment");
        return;
    }

    checklist.querySelectorAll('.item').forEach((item, index) => {
        const pass = item.querySelector('.pass');
        const fail = item.querySelector('.fail');
        const notes = item.querySelector('textarea').value.trim();
        const itemText = item.querySelector('strong').textContent;

        let status = 'Not checked';
        let className = '';

        if (pass?.checked) {
            status = 'PASS';
            className = 'success';
        } else if (fail?.checked) {
            status = 'FAIL';
            className = 'danger';
            hasFail = true;
        }

        summaryHTML += `
            <div style="margin: 12px 0; padding: 12px; background: #f8fafc; border-left: 5px solid ${className === 'danger' ? '#ef4444' : className === 'success' ? '#8AC865' : '#cbd5e1'}; border-radius: 6px;">
                <strong>${itemText}</strong><br>
                <span style="color: ${className === 'danger' ? '#991b1b' : className === 'success' ? '#065f46' : '#475569'}; font-weight: 600;">
                    ${status}
                </span>
                ${notes ? `<div style="margin-top:8px; color:#475569;">Notes: ${notes}</div>` : ''}
            </div>
        `;
    });

    if (hasFail) {
        document.getElementById('warning').style.display = 'block';
        summaryHTML += `
            <div style="margin-top: 2rem; padding: 16px; background: #fee2e2; color: #991b1b; border-radius: 8px; text-align: center; font-weight: bold;">
                ⚠️ EQUIPMENT NOT SAFE – REPORT DEFECTS IMMEDIATELY!
            </div>
        `;
    } else {
        summaryHTML += `
            <div style="margin-top: 2rem; padding: 16px; background: #ecfccb; color: #365314; border-radius: 8px; text-align: center; font-weight: bold;">
                ✓ All items passed – equipment appears safe for use
            </div>
        `;
    }

    document.getElementById('summary').innerHTML = summaryHTML;
    document.getElementById('summary').style.display = 'block';

    // Optional: scroll to summary
    document.getElementById('summary').scrollIntoView({ behavior: 'smooth' });
});
</script>
